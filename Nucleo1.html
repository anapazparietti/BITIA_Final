<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Historia de la Música - Bitia</title>
    <link rel="stylesheet" href="nucleo-1/style.css" />
    
    <style>
      /* ==== ESTILOS GENERALES ==== */

      html{
      font-size: 1rem;
      }

      *{
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      }

      body {
      margin: 0;
      overflow: hidden;
      background-image: url(Diseño/Frame\ 4.png);
      color: #222;
      background-size: cover;
      font-family: "Segoe UI", sans-serif;
      }

      .loop{
      position: fixed;
      bottom: 7rem;
      left: 2rem;
      z-index: 999999;
      }

      .loop img{
      width: 10rem;
      }

      @keyframes dialogoMov {
      0% {
      transform: scale(1); 
      }
      50% {
      transform: scale(1.03); 
      }
      100% {
      transform: scale(1); 
      }
      }

      .loop-dialogo{
      position: relative;
      width: auto;
      top: -1rem;
      left: 5rem;
      padding: 1rem;
      margin-bottom: 1rem;
      background-color: #fff;
      font-size: 1.1rem;
      font-weight: 400;
      line-height: 1.8;
      border-radius: 1rem;
      cursor: default;
      animation: dialogoMov 3s infinite ease-in-out;
      transition: transform 0.3s ease-in-out;
      }

      .loop-dialogo:before {
      content: "";
      width: 0px;
      height: 0px;
      position: absolute;
      border-left: 24px solid #fff;
      border-right: 12px solid transparent;
      border-top: 12px solid #fff;
      border-bottom: 20px solid transparent;
      bottom: -30px;
      }

      .container {
      max-width: 100%;
      height: 90vh;
      display: flex;
      background: transparent;
      padding: 20px;
      align-items: center;
      justify-content: center;
      gap: 100px;
      }

      /* === Contenedor 3D === */

      .container2 {
      width: 115vh;
      height: 84vh;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2;
      position: relative;
      }

      .ventana {
      display: block;
      perspective:1400px;
      width: 530px;
      height: 350px;
      flex-direction: row;
      position: fixed;  
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%); 
      z-index: 900;       
      overflow: visible;
      }

      .contenedor-3d {
      width: 100%;
      height: 100%;
      position: relative;
      transform-style: preserve-3d;
      transition: transform 600ms cubic-bezier(0.2, 0.9, 0.2, 1);
      transform: rotateX(-15deg);
      }

      /* === Estilo tarjetas === */

      .calendario-ventana {
      position:absolute;
      top:0;
      left:0;
      width:100%;
      height:100%;
      border-radius:10px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.6);
      color:#fff;
      font-size:1.25rem;
      opacity: 0.2;
      overflow: hidden;
      backface-visibility:hidden;
      transition: transform 600ms cubic-bezier(.2,.9,.2,1), opacity 300ms ease;
      cursor:pointer;
      user-select:none;
      }

      .contenido-calendario {
      display: grid;
      grid-template-columns: 1fr 1fr;
      margin: 1rem;
      text-align: left;
      }

      .year-calendario{
      display: inline-block;
      background-color: #2182AC;
      border-radius: 0.8rem;
      padding: 0.4rem 0.8rem;
      box-shadow: -3px -3px 0px 0px #88B2C0;
      margin-bottom: 1rem;
      }

      .parrafo-calendario{
      margin: 0 1rem 1rem 0;
      }

      .texto-calendario h3 {
      font-size: 1.5rem;
      margin-bottom: 10px;
      color: white;
      }

      .imagen-calendario img{
      width: 100%;
      height: 320px;
      border-radius: 5px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      }

      .calendario-ventana:nth-child(n){ background: linear-gradient(135deg,#0A3A5A 0%,#0B4A6F 15%,#2182AC 40%,#4ABEF2 65%,#8FE9FF 85%,#E6FBFF 100%);}

      .calendario-ventana.front{
      box-shadow: 0 30px 60px rgba(0,0,0,0.65);
      transform-origin:center;
      }

      /* === Barra lateral === */

      .rightbar {
      background: transparent;
      padding: 14px;
      border-radius: 8px;
      width: 25vh;
      height: 560px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      align-items: center;
      justify-content: center;
      z-index: 20;
      }

      /* ==== LED DE ESTADO ==== */

      .status-led {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-bottom: 25px;
      /* COLOR VERDE (Estado 1) */
      background-color: #a6ff00;
      box-shadow:
      0 0 15px #a6ff00,
      0 0 5px #fff;
      border: 2px solid rgba(255, 255, 255, 0.3);
      }

      .rightbar img {
      width: 115px;
      border-radius: 10px;
      transition:
      transform 0.15s,
      box-shadow 0.15s,
      filter 0.15s;
      z-index: 20;
      }

      .rightbar img.focused {
      outline: 4px solid rgba(255, 255, 255, 0.7);
      transform: scale(1.05);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.25);
      }

      .barra {
      width: 100vw;
      background: linear-gradient(180deg, #8B96B1 11.54%, #929295 14.9%, #132F47 75%);
      position: fixed;
      bottom: 0;
      left: 0;
      }

      .barra .taskbar-logo{
      position: sticky;
      width: 3vw;
      left: 0.5rem;
      margin-right: 2rem;
      cursor: pointer;
      }

      .barra .taskbar-widget{
      position: sticky;
      width: auto;
      height: 2.4rem;
      cursor: pointer;
      }

      /*======= MEDIA QUERIES PARA LA PANTALLA FINAL =======*/

      /*----------@media (max-width: 1024px) {
      .rightbar{
      padding-top: 1rem;
      }
      .taskbar .taskbar-logo{
      width: 4vw;
      left: 0.5rem;
      }
      }----------*/
    </style>
  </head>
  
  <!--==== ESTRUCTURA DEL NUCLEO (HTML) ====-->

  <body>
    <div class="container" id="mainContainer">
      <audio id="musica-nucleo-1" src="/Musicas/frutiger-song-nucleo-1.mp3"></audio>
      <div class="container2">
        <div class="ventana" data-ventana="calendario">
          <!---------- Contenedor 3D de todas las ventanas del calendario ---------->
          <div class="contenedor-3d">
            <!---------- Contenedor individual de los divs individuales o sea cada pagina o año de la linea ---------->
            <div class="calendario-ventana">
              <div class="contenido-calendario">
                <div class="texto-calendario">
                  <h3 class="year-calendario">1930/40</h3>
                  <h5>PIONEROS DEL SONIDO</h5>
                  <p class="parrafo-calendario">Raymond Scott, pionero en la música electrónica y experimental.</p>
                </div>
                <div class="imagen-calendario"><img src="../img/1930.png" alt="" /></div>
              </div>
            </div>
            <div class="calendario-ventana">
              <div class="contenido-calendario">
                <div class="texto-calendario">
                  <h3 class="year-calendario">1950</h3>
                  <p class="parrafo-calendario">Illiac Suite: Primera pieza generada por computadora.</p>
                  <p class="parrafo-calendario">
                    Raymond Scott desarrolla el Electronium, máquina que genera música a partir de patrones aleatorios.
                  </p>
                </div>
                <div class="imagen-calendario">
                  <img src="../img/1950.png" alt="Imagen de Raymond Scott con su 'Electronium'" />
                </div>
              </div>
            </div>
            <div class="calendario-ventana">
              <div class="contenido-calendario">
                <div class="texto-calendario">
                  <h3 class="year-calendario">1960/70</h3>
                  <p class="parrafo-calendario">MUSIC-N: Programas pioneros de síntesis digital (Max Mathews).</p>
                  <p class="parrafo-calendario">
                    Primer canto sintético en computadora (“Daisy Bell”), inspiración para HAL 9000.
                  </p>
                </div>
                <div class="imagen-calendario">
                  <img src="../img/1960.png" alt="Imagen de Max Mathews" />
                </div>
              </div>
            </div>
            <div class="calendario-ventana">
              <div class="contenido-calendario">
                <div class="texto-calendario">
                  <h3 class="year-calendario">1990</h3>
                  <p class="parrafo-calendario">
                    Proyectos académicos de síntesis de canto (Fraunhofer, MBROLA, DECtalk).
                  </p>
                </div>
                <div class="imagen-calendario"><img src="../img/1990.png" alt="" /></div>
              </div>
            </div>
            <div class="calendario-ventana">
              <div class="contenido-calendario">
                <div class="texto-calendario">
                  <h3 class="year-calendario">2000</h3>
                  <p class="parrafo-calendario">Vocaloid (Yamaha): Software de síntesis vocal realista.</p>
                  <p class="parrafo-calendario">
                    Hatsune Miku: Primera estrella pop virtual masiva con conciertos y fandom global.
                  </p>
                </div>
                <div class="imagen-calendario">
                  <img src="../img/2000.png" alt="Imagen de 'Hatsune Miku" />
                </div>
              </div>
            </div>
            <div class="calendario-ventana">
              <div class="contenido-calendario">
                <div class="texto-calendario">
                  <h3 class="year-calendario">2010</h3>
                  <p class="parrafo-calendario">
                    Flow Machines (Daddy 's Car): Primer tema pop compuesto por IA con notoriedad mundial.
                  </p>
                </div>
                <div class="imagen-calendario"><img src="../img/2010.png" alt="" /></div>
              </div>
            </div>
            <div class="calendario-ventana">
              <div class="contenido-calendario">
                <div class="texto-calendario">
                  <h3 class="year-calendario">2020</h3>
                  <p class="parrafo-calendario">
                    Expansión de la IA musical: AIVA compone bandas sonoras. FN Meka es un rapero virtual. Jukebox,
                    MusicLM o Suno crean canciones completas con letra y música.
                  </p>
                </div>
                <div class="imagen-calendario">
                  <img src="../img/2020.png" alt="Imagen del rapero IA 'FN Meka'" />
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <aside class="rightbar" id="rightBar">
        <div class="status-led"></div>
        <div>
          <a href="Nucleo1.html"><img src="Diseño/Frame 4 (1).png" alt="" /></a>
        </div>
        <div>
          <a href="Nucleo2.html"><img src="Diseño/Frame 5.png" alt="" /></a>
        </div>
        <div>
          <a href="nucleo3.html"><img src="Diseño/Frame 6.png" alt="" /></a>
        </div>
      </aside>
      <div class="loop" id="loop">
        <div class="loop-dialogo" id="loop-d">
          <p>Primero comenzaremos aprendiendo sobre la evolución de la música hasta la creación de la IA</p>
        </div>
        <img src="/img/loop-feliz.png" class="loop-img" alt="Imagen de loop ayudante virtual">
      </div>
    </div>
    <div class="barra">
      <img class="taskbar-logo" src="../img/windows-vista-icon-seeklogo.png">
      <img class="taskbar-widget" src="../img/calendario-barra.png">
    </div>

    <!--==== SCRIPTS DEL NUCLEO ====-->

    <script src="/js/dialogo-nucleo-1.js"></script>
    <script>  
      // IMPORTAR TECLAS GLOBALES
      const KEYS = window.parent.BITIA_KEYS || { ACCION: "+", ARRIBA: "8", ABAJO: "0", PLAY: "-", SALIR: "e" };
      
      // VARIABLE DE MODO
      window.modoSidebar = false;
      
      // ELEMENTOS
      const menu = document.querySelectorAll(".container2");
      const tarjetas = document.querySelectorAll(".calendario-ventana");
      const rightBarImgs = document.querySelectorAll(".rightbar img");
      let rightBarIndex = 0;
      let indiceCarrusel = 0;
      
      // MATH VISUAL ORIGINAL
      const ESPACIADO_X = 200;
      const ESPACIADO_Z = 280;
      const ROT_Y = 12;
      const FRONT_Z = 160;
      const FRONT_ESCALA = 1.06;
      
      // === ACTUALIZAR CARRUSEL ===
      function actualizarCarrusel() {
        tarjetas.forEach((tarjeta, i) => {
          const offset = i - indiceCarrusel;
          const absOff = Math.abs(offset);
            //Si la ventana esta al frente
          if (offset === 0) {
            tarjeta.classList.add("front");
            tarjeta.style.transform = `translateX(0px) translateZ(${FRONT_Z}px) rotateY(0deg) scale(${FRONT_ESCALA})`;
            tarjeta.style.opacity = "1";
            tarjeta.style.zIndex = "1000";
            // Si la ventana esta al detras de la del frente
          } else {
            tarjeta.classList.remove("front");
            const dir = offset < 0 ? 1 : -1;
            const x = -offset * ESPACIADO_X;
            const z = -absOff * ESPACIADO_Z;
            const rotY = dir * ROT_Y;
            tarjeta.style.transform = `translateX(${x}px) translateZ(${z}px) rotateY(${rotY}deg) scale(1)`;
            tarjeta.style.opacity = String(Math.max(0, 1 - absOff * 0.30));
            tarjeta.style.zIndex = String(900 - absOff);
          }
        });
      }
      
      // === ACTUALIZAR SIDEBAR ===
      function updateRightbarFocus() {
        rightBarImgs.forEach((img, i) => {
          if (window.modoSidebar && i === rightBarIndex) {
            img.classList.add("focused");
          } else {
            img.classList.remove("focused");
          }
        });
      }
      
      // === CONTROL DE MODO ===
      let accionTimeout = null;
      let accionLongPress = false;
      const accionHoldThreshold = 2000;
      
      function toggleMode() {
        window.modoSidebar = !window.modoSidebar;
        updateRightbarFocus();
      
        // Luces Arduino
        try {
          const parentApp = window.parent.app;
          if (parentApp && typeof parentApp.setNucleo === "function") {
            if (window.modoSidebar)
              parentApp.setNucleo(0); // Amarillo
            else parentApp.setNucleo(1); // Verde
          }
        } catch (e) {}
      }
      
      // === TECLADO CON PROTECCIÓN DE REPETICIÓN ===
      window.addEventListener("keydown", (e) => {
        if (e.repeat) return;
      
        const key = e.key.toLowerCase();
      
        // ACCION MANTENIDA
        if (key === KEYS.ACCION) {
          accionLongPress = false;
          accionTimeout = setTimeout(() => {
            accionLongPress = true;
            toggleMode();
          }, accionHoldThreshold);
        }
      });
      
      window.addEventListener("keyup", (e) => {
        if (e.key.toLowerCase() === KEYS.ACCION) {
          // Si soltamos antes de tiempo, limpiamos el timer
          if (accionTimeout) {
            clearTimeout(accionTimeout);
            accionTimeout = null;
          }
      
          // Click corto en sidebar
          if (!accionLongPress) {
            if (window.modoSidebar) {
              const target = rightBarImgs[rightBarIndex];
              const parentLink = target.closest("a");
              // Evita recargar si el link apunta a sí mismo (# o vacio)
              if (parentLink && parentLink.getAttribute("href") && parentLink.getAttribute("href") !== "#") {
                window.location.href = parentLink.getAttribute("href");
              }
            } else {
              // En modo carrusel, el click corto puede avanzar 1 slide (opcional)
              // O simplemente no hacer nada para evitar confusiones
            }
          }
      
          // Reseteamos bandera
          accionLongPress = false;
        }
      
        if (e.key.toLowerCase() === KEYS.SALIR) {
          window.location.href = "index.html";
        }
      });
      
      // === ENCODER ===
      window.addEventListener("message", (evento) => {
        if (evento.data && evento.data.tipo === "ENCODER_BITIA") {
          const delta = evento.data.dir === "CW" ? 1 : -1;
      
          if (window.modoSidebar) {
            // Mover Sidebar
            rightBarIndex = (rightBarIndex + delta + rightBarImgs.length) % rightBarImgs.length;
            updateRightbarFocus();
          } else {
            // Mover Carrusel (Solo visual)
            indiceCarrusel += delta;
            if (indiceCarrusel < 0) indiceCarrusel = 0;
            if (indiceCarrusel > tarjetas.length - 1) indiceCarrusel = tarjetas.length - 1;
            actualizarCarrusel();
          }
        }
      });
      
      // === INICIALIZAR ===
      actualizarCarrusel();
      updateRightbarFocus();
      
      // Forzar Estado 1 (Verde) al cargar
      document.addEventListener("DOMContentLoaded", () => {
        setTimeout(() => {
          try {
            const parentApp = window.parent.app;
            if (parentApp && typeof parentApp.setNucleo === "function") {
              parentApp.setNucleo(1);
            }
          } catch (e) {}
        }, 200);
      });
      
      // Nucleo1.html: Control de Scroll de Ratón/Trackpad (Reemplazar)
      
      // === CONTROL DE SCROLL DE RATÓN/TRACKPAD ===
      document.addEventListener("wheel", (e) => {
        e.preventDefault(); // Evita el scroll nativo
      
        // Determinamos la dirección:
        // deltaY > 0 es scroll hacia abajo (Avanza, +1), deltaY < 0 es scroll hacia arriba (Retrocede, -1).
        const delta = e.deltaY > 0 ? 1 : e.deltaY < 0 ? -1 : 0;
      
        // Si hay movimiento (delta no es 0)
        if (delta !== 0) {
          if (window.modoSidebar) {
            // 1. Mover Sidebar (Misma lógica que el ENCODER)
            rightBarIndex = (rightBarIndex + delta + rightBarImgs.length) % rightBarImgs.length;
            updateRightbarFocus();
          } else {
            // 2. Mover Carrusel (Misma lógica que el ENCODER)
            indiceCarrusel += delta;
      
            // Limitamos el índice
            if (indiceCarrusel < 0) indiceCarrusel = 0;
            if (indiceCarrusel > tarjetas.length - 1) indiceCarrusel = tarjetas.length - 1;
      
            // Actualizamos la vista 3D
            actualizarCarrusel();
          }
        }
      }); 
    </script>
  </body>
</html>