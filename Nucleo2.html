<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Panel de composici√≥n - demo</title>


<link rel="stylesheet" href="estilos/style-general.css">
<link rel="stylesheet" href="estilos/base-nucleo2.css">
<link rel="stylesheet" href="estilos/taskbar.css">

</head>
<body>

<div class="container" tabindex="0">
  <div class="all">
    <div class="container2" tabindex="0">
      <div class="nucleo-2">
        <div class="loop">
            <div id="loop-dialogo" class="bubble bubble-bottom-left">
                <img id="dialogo" src="#" alt="dialogos de loop">
            </div>
            <img src="../img/loop.png" alt="Imagen de loop, ayudante virtual">
        </div>

        <div class="reproductor">
             <div class="fondo">
                <img src="img/reproductor.png" alt="reproductor de m√∫sica Nucleo 3">
                 <ol class="contenedor-botones">
                    <li> <button class="btn" id="copyright">Copyright</button> </li>
                    <li> <button class="btn" id="canciones">Canciones</button> </li>
                    <li> <button class="btn" id="demandas">Demandas</button> </li>
                </ol>
                <div class="extras">
                    <button class="pausar"><img src="img/despausa.png" alt=""></button>
                    <div class="progreso">
                        <img src="img/linea.png" alt="">
                    </div>
                </div>
            </div>

            <div class="info-nucleo2">
            <div class="centro">
                <article class="copyright categoria video">
                    <video id="copyright-video" src="video/copyright.mp4"></video>
                </article>
                <article class="categoria canciones">
                    <h2>Canciones</h2>
                    <h1>Hechas con IAs musicales y reales</h1>
                    <ul>
                        <li>
                            <button ><img class="song" src="img/dust.png" alt=""></button>
                            <p class="hide-msj">Es una banda creada con IA.Su tema ‚ÄúDust on the Wind‚Äù se volvi√≥ viral en 2025 y revel√≥ c√≥mo la IA puede generar m√∫sica, voces e im√°genes, abriendo el debate sobre autor√≠a y creatividad artificial.</p>
                        </li>
                        <li>
                            <button ><img class="song" src="img/rumbaCongo.png" alt=""></button>
                             <p class="hide-msj">Es una creaci√≥n hecha con IA que imita m√∫sica afro-cubana. La banda y su historia son ficticias, mostrando c√≥mo la IA puede crear artistas. Poniendo en duda los l√≠mites entre lo real y lo artificial.</p>
                        </li>
                        <li>
                            <button ><img class="song" src="img/heart.png" alt=""></button>
                             <p class="hide-msj">Fue creada por el usuario an√≥nimo Ghostwriter con IA, imitando las voces de Drake y The Weeknd. Los artistas no participaron.El tema se volvi√≥ viral y fue eliminado por violar derechos de autor.</p>
                        </li>
                        <li>
                            <button ><img class="song" src="img/nostalgia.png" alt=""></button>
                             <p class="hide-msj">Canci√≥n del proyecto FlowGPT que utiliza voces generadas por IA para imitar a artistas como Bad Bunny, Daddy Yankee y Justin Bieber. La canci√≥n se volvi√≥ viral y Bad Bunny denunci√≥ el uso no autorizado de su voz.</p>
                        </li>
                        <li>
                            <button ><img class="song" src="img/pasarella.png" alt=""></button>
                             <p class="hide-msj">Canci√≥n de Emilia junto a Six Sex, lanzada en 2025.Combina pop y ritmos urbanos. A diferencia de otros casos recientes de m√∫sica generada con IA, esta es una composici√≥n original, creada e interpretada por las artistas sin uso de IA.</p>
                        </li>
                    </ul>
                </article>
                <article class="demandas categoria">
                    <h2>Demanda</h2>
                    <div id="cuerpo-demanda"></div>
                </article>
             </div>
             <div class="derecha">
                <article class="copyright categoria">
                    <div class="visual">
                        <video src="video/efecto1.mp4" autoplay loop muted></video>
                    </div>
                </article>
                <article class="categoria canciones">
                    <div class="visual">
                        <video id="canciones-video" src="video/dustontheWind.mp4"></video>
                    </div>
                </article>
                <article class="demandas categoria">
                    <ul>
                        <li><button><img class="btn-demanda" src="img/demanda1.png" alt=""></button></li>
                        <li><button><img class="btn-demanda" src="img/demanda2.png" alt="" id="demanda2"></button></li>
                    </ul>
                </article>
             </div>
             </div>
        </div>
      </div>
    </div>
  </div>
<!----------------- WIDGETS -->
  <aside class="rightbar" id="rightBar">
    <div><a href="Nucleo1.html"><img src="Dise√±o/Frame 4 (1).png" alt=""></a></div>
    <div><a href="Nucleo2.html"><img src="Dise√±o/Frame 5.png" alt=""></a></div>
    <div >
        <div ><a href="#" id="nucleo3" ><img src="img/nucleo3-bloqueado.png" alt="" id="nucleo3Img"></a></div>
    </div>
  </aside>
</div>

<!---------- BARRA DE TAREAS ---------->
        <div class="taskbar">
            <img class="taskbar-logo" src="../img/windows-vista-icon-seeklogo.png" alt="">
            <!-- PESTA√ëA DEL NUCLEO 2 -->
            <div class="pesta√±a-nucleo2">
                <img src="img/copyright.png" alt="est√°s en el n√∫cleo de copyright">
            </div>
        </div>

<script src="js/btn.js"></script>
<script src="js/dialogo.js"></script>
<script src="js/songs.js"></script>
<script src="js/demanda.js"></script>
<script src="js/copyright.js"></script>

<script>
    const KEYS = window.parent.BITIA_KEYS || { ACCION: '+', ARRIBA: '8', ABAJO: '0', PLAY: '-', SALIR: 'e' };

    window.modoSidebar = false;

    const rightBar = document.getElementById('rightBar');
    const rightBarImgs = rightBar.querySelectorAll('img');
    let rightBarIndex = 0;

    function updateRightbarFocus() {
        rightBarImgs.forEach((img, i) => {
            if (window.modoSidebar && i === rightBarIndex) {
                img.classList.add('focused');
            } else {
                img.classList.remove('focused');
            }
        });
    }

    // === CONTROL DE MODO ===
    let accionTimeout = null;
    let accionLongPress = false; // Bandera para distinguir click de mantener

    window.addEventListener('keydown', (e) => {
        // üî• PREVENIR REPETICI√ìN AUTOM√ÅTICA üî•
        if (e.repeat) return;

        const key = e.key.toLowerCase();

        // ACCION MANTENIDA (Sidebar)
        if (key === KEYS.ACCION) {
            accionLongPress = false; // Reseteamos al empezar a presionar
            accionTimeout = setTimeout(() => {
                accionLongPress = true; // ¬°Ahora s√≠ es larga!

                window.modoSidebar = !window.modoSidebar;
                console.log("Modo Sidebar:", window.modoSidebar);
                updateRightbarFocus();

                try {
                    const app = window.parent.app;
                    if (window.modoSidebar) app.setNucleo(0); // Amarillo
                    else app.setNucleo(2); // Azul
                } catch(e){}

                accionTimeout = null;
            }, 2000); // 2 segundos
        }
    });

    window.addEventListener('keyup', (e) => {
        if (e.key.toLowerCase() === KEYS.ACCION) {
            if (accionTimeout) {
                clearTimeout(accionTimeout);
                accionTimeout = null;
            }

            // ACCION CORTA (Click)
            // Solo ejecutamos si NO fue larga
            if (!accionLongPress) {
                // Si estamos en la barra y soltamos +, navegamos
                if (window.modoSidebar) {
                    const target = rightBarImgs[rightBarIndex];
                    const parentLink = target.closest('a');
                    if (parentLink) {
                        window.location.href = parentLink.href;
                    }
                }
                // Si estamos en la App, btn.js se encarga
            }

            accionLongPress = false; // Limpieza final
        }

        if (e.key.toLowerCase() === KEYS.SALIR) {
            window.location.href = 'inicio.html';
        }
    });

    // Nucleo2.html: Control de Scroll de Rat√≥n/Trackpad

    // === ENCODER === (Este c√≥digo ya existe en tu archivo)
    window.addEventListener('message', (evento) => {
        if (evento.data && evento.data.tipo === 'ENCODER_BITIA') {
            const delta = (evento.data.dir === "CW") ? 1 : -1;

            if (window.modoSidebar) {
                rightBarIndex = (rightBarIndex + delta + rightBarImgs.length) % rightBarImgs.length;
                updateRightbarFocus();
            }
        }
    });

    // === SCROLL DE RAT√ìN/TRACKPAD === (NUEVO C√ìDIGO)
    window.addEventListener('wheel', (e) => {

        e.preventDefault(); // Evita el scroll nativo

        // Determinamos la direcci√≥n: deltaY > 0 es scroll hacia abajo (Avanza, +1), deltaY < 0 es scroll hacia arriba (Retrocede, -1).
        const delta = e.deltaY > 0 ? 1 : (e.deltaY < 0 ? -1 : 0);

        // Si hay movimiento (delta no es 0)
        if (delta !== 0) {

            if (window.modoSidebar) {
                // Mover Sidebar, imitando el Encoder
                rightBarIndex = (rightBarIndex + delta + rightBarImgs.length) % rightBarImgs.length;
                updateRightbarFocus();
            }
            // Importante: Si window.modoSidebar es false, el scroll no hace nada,
            // ya que no hay otra acci√≥n definida para el encoder en este archivo.
        }
    }, { passive: false }); // Se a√±ade { passive: false } para asegurar que preventDefault() funciona


    // INIT
    updateRightbarFocus();

    document.addEventListener('DOMContentLoaded', () => {
        setTimeout(() => {
            try {
                const parentApp = window.parent.app;
                if (parentApp && typeof parentApp.setNucleo === 'function') {
                    parentApp.setNucleo(2);
                    console.log("Nucleo 2: Estado 2 enviado.");
                }
            } catch (e) { console.warn(e); }
        }, 200);
    });

</script>

</body>
</html>